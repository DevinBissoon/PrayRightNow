<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-2VEZCHJCS8"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
<link rel="icon" type="image/png" href="/favicon.png">

  gtag('config', 'G-2VEZCHJCS8');
</script>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Interactive Bible Helper</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Playfair+Display:wght@400;700&display=swap');
    body { font-family: 'Inter', sans-serif; }
    .font-serif { font-family: 'Playfair Display', serif; }
    .spinner { border:4px solid rgba(0,0,0,0.1); width:36px; height:36px; border-radius:50%; border-left-color:#6d28d9; animation:spin 1s linear infinite; }
    @keyframes spin { 0%{transform:rotate(0)} 100%{transform:rotate(360deg)} }
  </style>
  <noscript>
    <div style="padding:12px;background:#fee2e2;color:#991b1b;font-family:monospace">
      This site needs JavaScript enabled.
    </div>
  </noscript>
</head>
<body class="bg-gray-100 font-sans">
  <div id="app-container" class="min-h-screen flex items-center justify-center p-4">Loading…</div>

  <script>
  (function () {
    // Error bar instead of blank page
    function showError(msg) {
      try {
        var bar = document.createElement('div');
        bar.style.cssText = 'position:fixed;left:0;right:0;bottom:0;background:#fee2e2;color:#991b1b;padding:8px 12px;font-family:monospace;z-index:99999';
        bar.textContent = 'Error: ' + msg;
        document.body.appendChild(bar);
      } catch (_e) {}
    }
    window.addEventListener('error', function(e){ showError(e.message || 'Script error'); });
    window.addEventListener('unhandledrejection', function(e){
      var r = e && e.reason;
      showError((r && (r.message || r.statusText)) ? (r.message || r.statusText) : String(r));
    });

    function init(){
      var app = document.getElementById('app-container');
      if (!app) { showError('#app-container not found'); return; }

      // State
      var stage = 'start';
      var isLoading = false;
      var errorMessage = '';
      var selectedVerse = null;

      function render(){
        try {
          var html = '';
          if (isLoading) {
            html =
              '<div class="bg-white rounded-3xl shadow-2xl p-8 sm:p-12 max-w-2xl w-full flex flex-col items-center justify-center">' +
                '<div class="spinner"></div>' +
                '<p class="mt-6 text-xl text-gray-600 font-semibold text-center">Finding a verse just for you...</p>' +
              '</div>';
          } else {
            var verseBlock = '';
            if (selectedVerse) {
              var esc = function(s){ return String(s).replace(/[&<>]/g,function(m){return {'&':'&amp;','<':'&lt;','>':'&gt;'}[m];}); };
              verseBlock =
                '<p class="text-2xl sm:text-3xl italic text-gray-700 font-serif leading-relaxed mb-4">“' + esc(selectedVerse.text) + '”</p>' +
                '<p class="text-lg font-semibold text-purple-600 border-t border-gray-200 pt-4">' + esc(selectedVerse.reference) + '</p>';
            } else if (errorMessage) {
              verseBlock = '<p class="text-lg text-red-500 font-semibold text-center">' + errorMessage + '</p>';
            }

            if (stage === 'start') {
              html =
                '<div class="bg-white rounded-3xl shadow-2xl p-8 sm:p-12 max-w-2xl w-full">' +
                  '<div class="flex flex-col items-center space-y-4 text-center">' +
                    '<h1 class="text-3xl sm:text-4xl font-bold text-gray-800">Your Bible Helper</h1>' +
                    '<p class="text-lg sm:text-xl text-gray-600 max-w-md">A simple, private space to find a Bible verse that resonates with your heart today.</p>' +
                    '<div class="mt-4">' +
                      '<button id="start" class="px-8 py-4 bg-purple-600 text-white text-lg font-semibold rounded-full shadow-lg hover:bg-purple-700 transition">Find Your Verse</button>' +
                    '</div>' +
                  '</div>' +
                '</div>';
            } else if (stage === 'ask') {
              html =
                '<div class="bg-white rounded-3xl shadow-2xl p-8 sm:p-12 max-w-2xl w-full">' +
                  '<div class="flex flex-col items-center space-y-6 w-full max-w-xl text-center">' +
                    '<h2 class="text-2xl sm:text-3xl font-bold text-gray-800">How are you feeling today?</h2>' +
                    '<p class="text-md sm:text-lg text-gray-600">In a few words, describe what\'s on your heart</p>' +
                    '<form id="form" class="w-full">' +
                      '<input id="feeling" type="text" placeholder="e.g., Anxious, grateful, in need of guidance..." class="w-full px-4 py-3 border border-gray-300 rounded-xl shadow-inner focus:outline-none focus:ring-2 focus:ring-purple-500 transition" />' +
                      '<button type="submit" class="mt-6 w-full px-8 py-4 bg-purple-600 text-white text-lg font-semibold rounded-full shadow-lg hover:bg-purple-700 transition">Find a Verse</button>' +
                    '</form>' +
                    '<button id="back" class="mt-2 text-sm text-gray-500 underline">Back</button>' +
                  '</div>' +
                '</div>';
            } else if (stage === 'result') {
              html =
                '<div class="bg-white rounded-3xl shadow-2xl p-8 sm:p-12 max-w-2xl w-full">' +
                  '<div class="flex flex-col items-center space-y-6 text-center w-full max-w-xl">' +
                    '<h2 class="text-2xl sm:text-3xl font-bold text-gray-800">' + (selectedVerse ? 'A verse for your heart:' : 'Something went wrong') + '</h2>' +
                    '<div class="bg-gray-50 p-6 rounded-2xl shadow-xl w-full">' + verseBlock + '</div>' +
                    '<div class="flex flex-col sm:flex-row gap-3 mt-6 w-full">' +
                      '<button id="again" class="w-full px-8 py-4 bg-gray-200 text-gray-800 text-lg font-semibold rounded-full shadow-lg hover:bg-gray-300 transition">Start Over</button>' +
                    '</div>' +
                  '</div>' +
                '</div>';
            }
          }

          app.innerHTML = html;

          // Events
          if (stage === 'start') {
            var startBtn = document.getElementById('start');
            if (startBtn) startBtn.addEventListener('click', function(){ stage='ask'; render(); });
          } else if (stage === 'ask') {
            var backBtn = document.getElementById('back');
            if (backBtn) backBtn.addEventListener('click', function(){ stage='start'; render(); });
            var form = document.getElementById('form');
            if (form) form.addEventListener('submit', onSubmit);
          } else if (stage === 'result') {
            var again = document.getElementById('again');
            if (again) again.addEventListener('click', function(){ selectedVerse=null; errorMessage=''; stage='start'; render(); });
          }
        } catch (e) {
          showError(e && e.message ? e.message : String(e));
        }
      }

      function onSubmit(e){
        e.preventDefault();
        var input = document.getElementById('feeling');
        var feeling = input && input.value ? input.value.trim() : '';
        if (!feeling) return;

        isLoading = true; errorMessage=''; selectedVerse=null;
        render();

        fetch('/api/verse?feeling=' + encodeURIComponent(feeling), { headers: { 'Accept':'application/json' } })
          .then(function(r){ return r.json().then(function(j){ return {resp:r, data:j}; }); })
          .then(function(o){
            if (!o.resp.ok) {
              var detail = (o.data && o.data.error) ? o.data.error : (o.resp.status + ' ' + o.resp.statusText);
              throw new Error(detail);
            }
            selectedVerse = o.data;
          })
          .catch(function(err){
            errorMessage = 'Sorry, I couldn’t fetch a verse: ' + (err && err.message ? err.message : String(err));
          })
          .finally(function(){
            isLoading = false; stage='result'; render();
          });
      }

      // First paint
      stage = 'start';
      render();
    }

    if (document.readyState === 'loading') document.addEventListener('DOMContentLoaded', init);
    else init();
  })();
  </script>
</body>
</html>


